<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒˆãƒ©ãƒ³ãƒ—ãƒ»ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³</title>
    <style>
        :root {
            --bg-color: #2c2c2c;
            --text-color: #f0f0f0;
            --container-bg: #383838;
            --border-color: #555;
            --accent-color: #5cb85c;
            --accent-hover: #4cae4c;
        }
        body {
            font-family: 'Helvetica Neue', 'Arial', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            box-sizing: border-box;
            transition: background-color 0.3s;
        }
        .screen {
            display: none;
            width: 100%;
        }
        .screen.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
            background-color: var(--container-bg);
            max-width: 640px;
        }

        #game-over-screen, #game-clear-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 100;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
        }
        #game-over-screen.active {
            display: flex;
            background-color: black;
        }
        #game-clear-screen.active {
            display: flex;
            background-color: rgba(0, 0, 0, 0.8);
        }

        h1, h2 {
            text-align: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        .menu-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            width: 100%;
        }
        .btn, .menu-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background-color: var(--accent-color);
            color: white;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.2s;
            width: 80%;
            max-width: 300px;
            text-align: center;
        }
        .btn:hover, .menu-btn:hover {
            background-color: var(--accent-hover);
        }
        .btn-secondary {
            background-color: #777;
        }
        .btn-secondary:hover {
            background-color: #666;
        }

        #game-screen.active {
            max-width: 640px;
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        #player-stats {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #444;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        .stat { font-size: 1.1em; }
        .stat strong { color: #fff; }
        #dungeon-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        #dungeon, #message-log { margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; background-color: #444; }
        #hand { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .card { background: #fdfdfd; border: 1px solid #999; border-radius: 8px; padding: 10px; cursor: pointer; width: 100px; text-align: center; transition: transform 0.2s, box-shadow 0.2s; display: flex; flex-direction: column; justify-content: space-between; min-height: 140px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .card:hover { transform: translateY(-8px); box-shadow: 0 10px 15px rgba(0,0,0,0.4); }
        .card-face { font-size: 2.5em; font-weight: bold; }
        .card-info { font-size: 0.9em; }
        .card-type { display: block; font-weight: bold; margin-bottom: 5px; }
        .card-value { display: block; font-size: 0.8em; color: #555; }
        .spades .card-face, .clubs .card-face { color: #333; }
        .hearts .card-face { color: #d9534f; }
        .diamonds .card-face { color: #428bca; }
        .joker .card-face { color: #8a2be2; }
        .curse .card-face { font-size: 3.5em; color: #5a0000; }
        .curse { background: #111; border: 2px solid #5a0000; }
        .curse .card-type, .curse .card-value { color: #ff9999; }
        
        .spades .card-type, .clubs .card-type { color: #333; }
        .hearts .card-type { color: #d9534f; }
        .diamonds .card-type { color: #428bca; }
        .joker .card-type { color: #8a2be2; }
        #message-log { min-height: 40px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; color: var(--text-color); }
        
        .color-picker { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; width:100%; max-width: 300px;}
        .color-swatch { width: 100%; height: 50px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s; }
        .color-swatch:hover { border-color: #fff; }

        #rules-content { padding: 10px; line-height: 1.6; }

        #game-over-screen h2.game-over-title { color: red; font-size: 3.5em; margin-bottom: 15px; border-bottom: none; text-shadow: 0 0 10px red; animation: pulse 1.5s infinite alternate; }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }
        
        #game-clear-screen h2 { color: gold; font-size: 3.5em; margin-bottom: 15px; border-bottom: none; text-shadow: 0 0 10px gold; animation: pulse-gold 1.5s infinite alternate; }
        #game-clear-screen p { color: white; font-size: 1.8em; margin-bottom: 40px; }
        @keyframes pulse-gold { from { transform: scale(1); } to { transform: scale(1.05); } }
    </style>
</head>
<body>

    <div id="title-screen" class="screen active">
        <h1>ãƒˆãƒ©ãƒ³ãƒ—ãƒ»ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³</h1>
        <div class="menu-container">
            <button class="menu-btn" onclick="runGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button class="menu-btn btn-secondary" onclick="showScreen('settings-screen')">è¨­å®š</button>
        </div>
    </div>

    <div id="settings-screen" class="screen">
        <h2>è¨­å®š</h2>
        <div class="menu-container">
            <button class="menu-btn" onclick="showScreen('color-picker-screen')">èƒŒæ™¯è‰²ã‚’å¤‰æ›´</button>
            <button class="menu-btn" onclick="showScreen('rules-screen')">ãƒ«ãƒ¼ãƒ«</button>
            <button class="menu-btn btn-secondary" onclick="showScreen('title-screen')">æˆ»ã‚‹</button>
        </div>
    </div>

    <div id="rules-screen" class="screen">
        <h2>ãƒ«ãƒ¼ãƒ«</h2>
        <div id="rules-content">
            <p>ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚’ç”Ÿãå»¶ã³ã€å±±æœ­ã‚’å…¨ã¦å¼•ãåˆ‡ã‚Œã°ã‚¯ãƒªã‚¢ã§ã™ã€‚</p>
            <ul>
                <li><strong>â™ /â™£ (æ•µ):</strong> æˆ¦ã£ã¦å€’ã—ã¾ã™ã€‚æ­¦å™¨ãŒãªã„ã‹ã€æ•µã®æ”»æ’ƒåŠ›ãŒæ­¦å™¨ã‚ˆã‚Šé«˜ã„ã¨ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã¾ã™ã€‚æˆ¦é—˜å¾Œã€æ­¦å™¨ã¯å£Šã‚Œã¾ã™ã€‚</li>
                <li><strong>â™¥ (å›å¾©):</strong> HPã‚’å›å¾©ã—ã¾ã™ã€‚</li>
                <li><strong>â™¦ (æ­¦å™¨):</strong> è£…å‚™ã—ã¦æ•µã‹ã‚‰ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’é˜²ãã¾ã™ã€‚</li>
                <li><strong>ğŸƒ (ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼):</strong> å ´ã«ã‚ã‚‹ä»–ã®ã‚«ãƒ¼ãƒ‰ã‚’å…¨ã¦æ¶ˆã—å»ã‚Šã¾ã™ã€‚</li>
                <li><strong>è©› (å‘ªã„ã®ã‚«ãƒ¼ãƒ‰):</strong> ã“ã®ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¶ã¨å‘ªã‚ã‚Œã€HPãŒ5æ¸›å°‘ã—ã¾ã™ã€‚</li>
                <li><strong>ãƒãƒªã‚¬ãƒ³:</strong> HPã®åŠåˆ†ã‚’ã‚³ã‚¹ãƒˆã«ã€å ´ã®æ‰‹æœ­ã‚’å…¨ã¦å¼•ãç›´ã—ã¾ã™ã€‚</li>
            </ul>
        </div>
        <div class="menu-container">
            <button class="menu-btn btn-secondary" onclick="showScreen('settings-screen')">æˆ»ã‚‹</button>
        </div>
    </div>

    <div id="color-picker-screen" class="screen">
        <h2>èƒŒæ™¯è‰²ã‚’é¸æŠ</h2>
        <div class="color-picker">
            <div class="color-swatch" style="background-color: red;" onclick="changeBackgroundColor('red')"></div>
            <div class="color-swatch" style="background-color: blue;" onclick="changeBackgroundColor('blue')"></div>
            <div class="color-swatch" style="background-color: yellow;" onclick="changeBackgroundColor('yellow')"></div>
            <div class="color-swatch" style="background-color: green;" onclick="changeBackgroundColor('green')"></div>
            <div class="color-swatch" style="background-color: orange;" onclick="changeBackgroundColor('orange')"></div>
            <div class="color-swatch" style="background-color: purple;" onclick="changeBackgroundColor('purple')"></div>
            <div class="color-swatch" style="background-color: white;" onclick="changeBackgroundColor('white')"></div>
            <div class="color-swatch" style="background-color: black;" onclick="changeBackgroundColor('black')"></div>
            <div class="color-swatch" style="background-color: gray;" onclick="changeBackgroundColor('gray')"></div>
        </div>
        <div class="menu-container">
            <button class="menu-btn btn-secondary" onclick="showScreen('settings-screen')">æˆ»ã‚‹</button>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div id="game-container">
            <h1>ãƒˆãƒ©ãƒ³ãƒ—ãƒ»ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³</h1>
            <div id="player-stats"></div>
            <div id="dungeon">
                <div id="dungeon-header">
                    <h2>ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³</h2>
                    <button id="mulligan-btn" class="btn" onclick="mulligan()">ãƒãƒªã‚¬ãƒ³</button>
                </div>
                <div id="hand"></div>
            </div>
            <div id="message-log"></div>
        </div>
    </div>

    <div id="game-over-screen" class="screen">
        <h2 class="game-over-title">GAME OVER......</h2>
        <div class="menu-container">
            <button class="menu-btn" onclick="runGame()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
            <button class="menu-btn btn-secondary" onclick="showScreen('title-screen')">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
        </div>
    </div>

    <div id="game-clear-screen" class="screen">
        <h2>ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼</h2>
        <p style="text-align: center; margin-bottom: 20px;">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚’æ”»ç•¥ã—ã¾ã—ãŸã€‚</p>
        <div class="menu-container">
            <button class="menu-btn" onclick="runGame()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
            <button class="menu-btn btn-secondary" onclick="showScreen('title-screen')">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
        </div>
    </div>


<script>
const suits = ['â™ ', 'â™£', 'â™¥', 'â™¦'];
const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
const MAX_HP = 20;

let playerHp;
let equippedWeapon;
let deck;
let hand;
let gameMessage;

function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');
}

function hexToRgb(hex) {
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null;
}

function changeBackgroundColor(color) {
    const root = document.querySelector(':root');
    let isDark = false;
    if (['black', 'purple', '#2c2c2c', 'gray', 'blue', 'green'].includes(color)) {
        isDark = true;
    } else if (color.startsWith('#')) {
        const rgb = hexToRgb(color);
        if (rgb) { isDark = (rgb.r * 0.299 + rgb.g * 0.587 + rgb.b * 0.114) < 186; }
    } else {
        isDark = !(['white', 'yellow', 'orange'].includes(color));
    }
    root.style.setProperty('--bg-color', color);
    root.style.setProperty('--text-color', isDark ? '#f0f0f0' : '#333');
    root.style.setProperty('--container-bg', isDark ? '#383838' : '#e0e0e0');
    root.style.setProperty('--border-color', isDark ? '#555' : '#ccc');
}

function getCardValue(rank) {
    if (rank === 'A') return 1;
    if (rank === 'J') return 11;
    if (rank === 'Q') return 12;
    if (rank === 'K') return 13;
    return parseInt(rank, 10);
}

function createDeck() {
    const newDeck = [];
    for (const suit of suits) {
        for (const rank of ranks) {
            newDeck.push({ suit, rank, value: getCardValue(rank) });
        }
    }
    newDeck.push({ suit: 'ğŸƒ', rank: 'JOKER', value: 0 });
    newDeck.push({ suit: 'è©›', rank: 'CURSE', value: 0 }); // Add one curse card
    return newDeck;
}

function shuffleDeck(deckToShuffle) {
    for (let i = deckToShuffle.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deckToShuffle[i], deckToShuffle[j]] = [deckToShuffle[j], deckToShuffle[i]];
    }
}

function runGame() {
    startGame();
    showScreen('game-screen');
}

function startGame() {
    playerHp = MAX_HP;
    equippedWeapon = null;
    deck = createDeck();
    shuffleDeck(deck);
    hand = [];
    gameMessage = 'ãƒ©ãƒ“ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã®å†’é™ºã¸ã‚ˆã†ã“ãï¼';
    drawCards();
}

function drawCards() {
    if (deck.length === 0 && hand.length === 0) {
        showScreen('game-clear-screen');
        return;
    }
    const cardsNeeded = 4 - hand.length;
    const cardsToDraw = Math.min(cardsNeeded, deck.length);

    for (let i = 0; i < cardsToDraw; i++) {
        hand.push(deck.pop());
    }
    renderGame();
}

function renderGame() {
    const statsDiv = document.getElementById('player-stats');
    let weaponText = 'ãªã—';
    if (equippedWeapon) {
        weaponText = `${equippedWeapon.suit}${equippedWeapon.rank} (æ”»æ’ƒåŠ› ${equippedWeapon.value})`;
    }
    statsDiv.innerHTML = `
        <div class="stat">HP: <strong>${playerHp}/${MAX_HP}</strong></div>
        <div class="stat">æ­¦å™¨: <strong>${weaponText}</strong></div>
        <div class="stat">å±±æœ­æ®‹ã‚Š: <strong>${deck.length}æš</strong></div>
    `;

    const handDiv = document.getElementById('hand');
    handDiv.innerHTML = '';
    hand.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        let typeText = '';
        let valueText = '';
        
        switch (card.suit) {
            case 'â™ ': case 'â™£':
                cardDiv.classList.add(card.suit === 'â™ ' ? 'spades' : 'clubs');
                typeText = 'æ•µ'; valueText = `æ”»æ’ƒåŠ›: ${card.value}`; break;
            case 'â™¥':
                cardDiv.classList.add('hearts');
                typeText = 'å›å¾©'; valueText = `å›å¾©é‡: ${card.value}`; break;
            case 'â™¦':
                cardDiv.classList.add('diamonds');
                typeText = 'æ­¦å™¨'; valueText = `æ”»æ’ƒåŠ›: ${card.value}`; break;
            case 'ğŸƒ':
                cardDiv.classList.add('joker');
                typeText = 'ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼'; valueText = 'å ´ã®ã‚«ãƒ¼ãƒ‰ã‚’æ¶ˆã™'; break;
            case 'è©›':
                cardDiv.classList.add('curse');
                typeText = 'å‘ªã„ã®ã‚«ãƒ¼ãƒ‰'; valueText = 'HP-5'; break;
        }

        cardDiv.classList.add('card');
        cardDiv.innerHTML = `
            <div class="card-face">${card.suit}${card.rank === 'JOKER' || card.rank === 'CURSE' ? '' : card.rank}</div>
            <div class="card-info"><span class="card-type">${typeText}</span><span class="card-value">${valueText}</span></div>
        `;
        cardDiv.onclick = () => playCard(index);
        handDiv.appendChild(cardDiv);
    });

    document.getElementById('message-log').textContent = gameMessage;
}

function playCard(cardIndex) {
    if (playerHp <= 0 || !hand[cardIndex]) return;
    const card = hand.splice(cardIndex, 1)[0];

    switch (card.suit) {
        case 'â™ ': case 'â™£':
            let damage = card.value;
            if (equippedWeapon) {
                if (card.value <= equippedWeapon.value) {
                    damage = 0;
                    gameMessage = `${card.suit}${card.rank}(${card.value})ã‚’ç„¡å‚·ã§å€’ã—ãŸï¼`;
                } else {
                    damage = card.value - equippedWeapon.value;
                    gameMessage = `${card.suit}${card.rank}(${card.value})ã¨æˆ¦ã„ã€${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸ...`;
                }
                gameMessage += ` æ­¦å™¨(${equippedWeapon.suit}${equippedWeapon.rank})ãŒå£Šã‚ŒãŸã€‚`;
                equippedWeapon = null;
            } else {
                gameMessage = `${card.suit}${card.rank}(${card.value})ã¨æˆ¦ã„ã€${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸ...`;
            }
            playerHp -= damage;
            break;
        case 'â™¥':
            playerHp = Math.min(MAX_HP, playerHp + card.value);
            gameMessage = `${card.suit}${card.rank}(${card.value})ã‚’é£Ÿã¹ãŸã€‚HPãŒ${card.value}å›å¾©ã—ãŸã€‚`;
            break;
        case 'â™¦':
            gameMessage = `${card.suit}${card.rank}(${card.value})ã‚’è£…å‚™ã—ãŸã€‚`;
            equippedWeapon = card;
            break;
        case 'ğŸƒ':
            gameMessage = "ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã®åŠ¹æœã§å ´ã®ã‚«ãƒ¼ãƒ‰ãŒæ¶ˆãˆå»ã£ãŸï¼";
            hand = [];
            break;
        case 'è©›':
            playerHp -= 5;
            gameMessage = "å‘ªã„ã®ã‚«ãƒ¼ãƒ‰ã«è§¦ã‚Œã¦ã—ã¾ã£ãŸï¼HPã‚’5å¤±ã£ãŸâ€¦";
            break;
    }

    if (playerHp <= 0) {
        playerHp = 0;
        showScreen('game-over-screen');
    } else {
        drawCards();
    }
}

function mulligan() {
    if (playerHp <= 0) return;
    if (deck.length < 4) {
        gameMessage = "å±±æœ­ãŒè¶³ã‚Šãªã„ã®ã§ãƒãƒªã‚¬ãƒ³ã§ãã¾ã›ã‚“ã€‚";
        renderGame();
        return;
    }

    const hpLost = Math.ceil(playerHp / 2);
    playerHp -= hpLost;
    gameMessage = `æ‰‹æœ­ã‚’äº¤æ›ã—ãŸã€‚HPãŒ${hpLost}æ¸›å°‘ã—ãŸã€‚`;
    
    if (playerHp <= 0) {
        playerHp = 0;
        showScreen('game-over-screen');
    } else {
        hand = [];
        drawCards();
    }
}

// Initial load
showScreen('title-screen');

</script>
</body>
</html>